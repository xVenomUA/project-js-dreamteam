{"version":3,"file":"commonHelpers.js","sources":["../src/img/yellowBasket.png","../src/js/korzina.js"],"sourcesContent":["export default \"__VITE_ASSET__331ff7d5__\"","import { getProductById } from './APIFoodBoutique';\nimport { postOrders } from './APIFoodBoutique';\nimport { onChangeCount } from './headerFunctionCount';\nimport iconimg from '/img/icon.svg';\nimport basket from '/img/yellowBasket.png';\n/* <!-- ₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴\n₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴\n    Ivan || Yulia || Valentyn\n₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴\n₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴₴ --> */\n// common\nconst common = {\n  FILTERS_KEY: 'filters',\n  CART_KEY: 'cart',\n};\nconst cardCounter = document.querySelector('span#cart-counter');\nconst cartJsBlock = document.querySelector('.js-cart-block');\nconst cartListBlock = document.querySelector('.cart-list-block');\nconst cartDeleteBtn = document.querySelector('.cart-delete-btn');\nconst cartForm = document.querySelector('.cart-form')\nconst modalBasket = document.querySelector('.modal-backdrop-two');\n\ncartDeleteBtn.addEventListener('click', onClick);\n\nfunction onClick() {\n  localStorage.removeItem('cart');\n  cardUse();\n}\n\nfunction getDataLocalStorage(key) {\n  try {\n    const data = localStorage.getItem(key);\n    return data ? JSON.parse(data) : [];\n  } catch (error) {\n    console.log(error.message);\n  }\n}\n\nasync function cardUse() {\n  let cartArr = await getDataLocalStorage(common.CART_KEY);\n\n  cardCounter.textContent = cartArr.length;\n\n  if (cartArr.length === 0) {\n    cartJsBlock.innerHTML = createMarkupCartEmpty();// createMarkup empty cart\n    onChangeCount();\n    return;\n  }\n  renderCards(cartArr);\n  // deleteAllBtn\n}\ncardUse();\n\nasync function renderCards() {\n  const cartArr = getDataLocalStorage('cart');\n  const id = cartArr.map(item => item._id);\n  cartListBlock.innerHTML = '';\n\n  try {\n    let total = 0;\n    let prices = [];\n    let cartList = [];\n    let listArr = []; // елементи в корзині\n    for (let i = 0; i < id.length; i += 1) {\n      const resp = await getProductById(id[i]);\n      const cartId = renderProdCard(resp, id[i]);\n      cartListBlock.innerHTML += cartId;\n\n      const cartParce = JSON.parse(localStorage.getItem('cart'));\n      total += resp.price;\n      prices.push(resp.price);\n      spanYourOrderPrice.textContent = `${Number(total.toFixed(2))}`;\n\n      waitForElements('.cart-close')\n        .then(elements => {\n          listArr.push(cartParce[i]._id);\n\n          localStorage.setItem('cart1', JSON.stringify(cartList));\n          elements.forEach(element => {\n            element.addEventListener('click', e => {\n              const id = e.currentTarget.id;\n\n              listArr = listArr.filter(item => item !== id);\n\n              cartList = [];\n              for (let j = 0; j < listArr.length; j += 1) {\n                cartList.push({ _id: listArr[j], quantity: 1 });\n              }\n\n              localStorage.setItem('cart', JSON.stringify(cartList));\n              cardUse();\n            });\n          });\n        })\n\n        .catch(error => {\n          console.error(error.message);\n        });\n    }\n  } catch (e) {\n    console.log(e);\n  }\n}\n\nfunction waitForElements(selector) {\n  return new Promise((resolve, reject) => {\n    const elements = document.querySelectorAll(selector);\n\n    if (elements.length > 0) {\n      resolve(elements);\n    } else {\n      const observer = new MutationObserver(() => {\n        const updatedElements = document.querySelectorAll(selector);\n        if (updatedElements.length > 0) {\n          observer.disconnect();\n          resolve(updatedElements);\n        }\n      });\n\n      observer.observe(document.documentElement, {\n        childList: true,\n        subtree: true,\n      });\n    }\n  });\n}\n//скрол для корзини\ndocument.addEventListener(\"DOMContentLoaded\", function () {\n  const cart = document.getElementById(\"cart\");\n  const scrollThreshold = 100;\n\n  window.addEventListener(\"scroll\", function () {\n    const scrollPosition = window.scrollY;\n  });\n});\n// рендер доданої картки\n\nfunction renderProdCard(product) {\n  if (product.category.includes('_')) {\n    product.category = product.category.replace(/_/g, ' ');\n  }\n\n  return `\n        <li class=\"cart-card-container\" data-productlist-id=\"${product._id}\">\n          <div class=\"cart-image-container\">\n            <img src=\"${product.img}\" alt=\"${product.name}\" class=\"\">\n          </div>\n        \n        <div class=\"cart-info\">\n          <div class=\"cart-descript-text\">\n          <div class=\"cart-div-new\">\n            <p class=\"cart-prod-name\">${product.name}</p>\n            <button type=\"button\" id=\"${product._id}\" class=\"cart-close\">\n              <svg class=\"cart-close-icon\" width=\"10.125\" height=\"10.125\">\n                <use href=\"${iconimg}#icon-close\"></use>\n              </svg>\n            </button>\n            </div>\n          <div class=\"cart-frame\">\n  \n          <div class=\"category-cont\">\n              <ul class=\"cart-text-cat\">\n              <li>\n              <p class=\"cart-category-text\">Category:\n              <span class=\" cart-category-black\">${product.category}</span></p>\n              </li>\n              <li class=\"cart-text-size\">\n\n            <p class=\"cart-size-text\">Size:\n              <span class=\"cart-size-black\">${product.size}</span></p></li>\n              \n          </div>\n  \n            <div class=\"cart-price\">\n            <p class=\"cart-card-price\">$${product.price}</p>\n          </div>\n          </div>\n        </div>\n      </div>\n      </li>\n      <hr class=\"cart-line\">\n    `;\n}\n\nfunction createMarkupCartEmpty() {\n  return ` \n  <div class=\"js-cart-block\">\n  <div class=\"cart-empty-new\">\n  <div class=\"cart-empty-basket\">\n  <img class=\"cart-basket-img\"\n                src=\"${basket}\"\n                alt=\"yellow basket\"\n                loading=\"lazy\"\n                width=\"132\"\n                height=\"114\"\n              />\n  </div>\n  <div class=\"cart-empty-desc\">\n              <ul class=\"cart-desc-ul\">\n                <li>\n                  <p class=\"cart-empty-text\">\n                    Your basket is <span class=\"cart-text-span\">\n                    empty...</span>\n                  </p>\n                </li>\n                <li>\n                  <p class=\"cart-gray-text\">\n                    Go to the main page to select your favorite <br /> products and add\n                    them to the cart.\n                  </p>\n                </li>\n              </ul>\n            </div>\n            </div>\n  `;\n}\n\nconst spanYourOrderPrice = document.querySelector(\n  'span#your-order-total-price'\n);\n\ncartForm.addEventListener('submit', onCheckout)\n\nasync function onCheckout(event) {\n  event.preventDefault();\n  const cardError = document.querySelector('.error-message')\n  const email = document.querySelector('.cart-email-input').value;\n  onChangeCount();\n  const cartItems = getDataLocalStorage('cart');\n  const orderData = createOrderObject(email, cartItems);\n\n  try {\n    const response = await postOrders(orderData);\n\n    toggleModal(true);\n    document.body.style.overflow = \"hidden\";\n    localStorage.removeItem('cart');\n    onChangeCount();\n    cardUse();\n  } catch (error) {\n    cardError.style.display = 'block'\n    setTimeout(() => cardError.style.display = 'none', 2000);\n  }\n};\n\nfunction createOrderObject(email, cartItems) {\n  return {\n    email: email,\n    products: cartItems.map(item => ({\n      productId: item._id,\n      amount: item.quantity\n    }))\n  };\n}\n\nfunction toggleModal(show = true) {\n  modalBasket.classList.toggle('is-hidden-basket', !show);\n  if (show) {\n    setupModalCloseEvents();\n  }\n  document.body.style.overflow = \"scroll\";\n}\n\nfunction setupModalCloseEvents() {\n  const closeModalBtn = document.querySelector('.modal-close-btn-basket');\n  closeModalBtn.addEventListener('click', () => toggleModal(false));\n  modalBasket.addEventListener('click', event => {\n    if (event.target === modalBasket) {\n      toggleModal(false);\n    }\n  });\n\n}"],"names":["basket","common","cardCounter","cartJsBlock","cartListBlock","cartDeleteBtn","cartForm","modalBasket","onClick","cardUse","getDataLocalStorage","key","data","error","cartArr","createMarkupCartEmpty","onChangeCount","renderCards","id","item","total","prices","cartList","listArr","i","resp","getProductById","cartId","renderProdCard","cartParce","spanYourOrderPrice","waitForElements","elements","element","e","j","selector","resolve","reject","observer","updatedElements","product","iconimg","onCheckout","event","cardError","email","cartItems","orderData","createOrderObject","response","postOrders","toggleModal","show","setupModalCloseEvents"],"mappings":"+GAAA,MAAeA,EAAA,yDCWTC,EAAS,CACb,YAAa,UACb,SAAU,MACZ,EACMC,EAAc,SAAS,cAAc,mBAAmB,EACxDC,EAAc,SAAS,cAAc,gBAAgB,EACrDC,EAAgB,SAAS,cAAc,kBAAkB,EACzDC,EAAgB,SAAS,cAAc,kBAAkB,EACzDC,EAAW,SAAS,cAAc,YAAY,EAC9CC,EAAc,SAAS,cAAc,qBAAqB,EAEhEF,EAAc,iBAAiB,QAASG,CAAO,EAE/C,SAASA,GAAU,CACjB,aAAa,WAAW,MAAM,EAC9BC,GACF,CAEA,SAASC,EAAoBC,EAAK,CAChC,GAAI,CACF,MAAMC,EAAO,aAAa,QAAQD,CAAG,EACrC,OAAOC,EAAO,KAAK,MAAMA,CAAI,EAAI,CAAA,CAClC,OAAQC,EAAP,CACA,QAAQ,IAAIA,EAAM,OAAO,CAC1B,CACH,CAEA,eAAeJ,GAAU,CACvB,IAAIK,EAAU,MAAMJ,EAAoBT,EAAO,QAAQ,EAIvD,GAFAC,EAAY,YAAcY,EAAQ,OAE9BA,EAAQ,SAAW,EAAG,CACxBX,EAAY,UAAYY,IACxBC,IACA,MACD,CACDC,EAAmB,CAErB,CACAR,IAEA,eAAeQ,GAAc,CAE3B,MAAMC,EADUR,EAAoB,MAAM,EACvB,IAAIS,GAAQA,EAAK,GAAG,EACvCf,EAAc,UAAY,GAE1B,GAAI,CACF,IAAIgB,EAAQ,EACRC,EAAS,CAAA,EACTC,EAAW,CAAA,EACXC,EAAU,CAAA,EACd,QAASC,EAAI,EAAGA,EAAIN,EAAG,OAAQM,GAAK,EAAG,CACrC,MAAMC,EAAO,MAAMC,EAAeR,EAAGM,EAAE,EACjCG,EAASC,EAAeH,EAAMP,EAAGM,EAAE,EACzCpB,EAAc,WAAauB,EAE3B,MAAME,EAAY,KAAK,MAAM,aAAa,QAAQ,MAAM,CAAC,EACzDT,GAASK,EAAK,MACdJ,EAAO,KAAKI,EAAK,KAAK,EACtBK,EAAmB,YAAc,GAAG,OAAOV,EAAM,QAAQ,CAAC,CAAC,IAE3DW,EAAgB,aAAa,EAC1B,KAAKC,GAAY,CAChBT,EAAQ,KAAKM,EAAUL,GAAG,GAAG,EAE7B,aAAa,QAAQ,QAAS,KAAK,UAAUF,CAAQ,CAAC,EACtDU,EAAS,QAAQC,GAAW,CAC1BA,EAAQ,iBAAiB,QAASC,GAAK,CACrC,MAAMhB,EAAKgB,EAAE,cAAc,GAE3BX,EAAUA,EAAQ,OAAOJ,GAAQA,IAASD,CAAE,EAE5CI,EAAW,CAAA,EACX,QAASa,EAAI,EAAGA,EAAIZ,EAAQ,OAAQY,GAAK,EACvCb,EAAS,KAAK,CAAE,IAAKC,EAAQY,GAAI,SAAU,CAAC,CAAE,EAGhD,aAAa,QAAQ,OAAQ,KAAK,UAAUb,CAAQ,CAAC,EACrDb,GACd,CAAa,CACb,CAAW,CACX,CAAS,EAEA,MAAMI,GAAS,CACd,QAAQ,MAAMA,EAAM,OAAO,CACrC,CAAS,CACJ,CACF,OAAQqB,EAAP,CACA,QAAQ,IAAIA,CAAC,CACd,CACH,CAEA,SAASH,EAAgBK,EAAU,CACjC,OAAO,IAAI,QAAQ,CAACC,EAASC,IAAW,CACtC,MAAMN,EAAW,SAAS,iBAAiBI,CAAQ,EAEnD,GAAIJ,EAAS,OAAS,EACpBK,EAAQL,CAAQ,MACX,CACL,MAAMO,EAAW,IAAI,iBAAiB,IAAM,CAC1C,MAAMC,EAAkB,SAAS,iBAAiBJ,CAAQ,EACtDI,EAAgB,OAAS,IAC3BD,EAAS,WAAU,EACnBF,EAAQG,CAAe,EAEjC,CAAO,EAEDD,EAAS,QAAQ,SAAS,gBAAiB,CACzC,UAAW,GACX,QAAS,EACjB,CAAO,CACF,CACL,CAAG,CACH,CAEA,SAAS,iBAAiB,mBAAoB,UAAY,CAC3C,SAAS,eAAe,MAAM,EAG3C,OAAO,iBAAiB,SAAU,UAAY,CAEhD,CAAG,CACH,CAAC,EAGD,SAASX,EAAea,EAAS,CAC/B,OAAIA,EAAQ,SAAS,SAAS,GAAG,IAC/BA,EAAQ,SAAWA,EAAQ,SAAS,QAAQ,KAAM,GAAG,GAGhD;AAAA,+DACsDA,EAAQ;AAAA;AAAA,wBAE/CA,EAAQ,aAAaA,EAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wCAMbA,EAAQ;AAAA,wCACRA,EAAQ;AAAA;AAAA,6BAEnBC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mDAUsBD,EAAQ;AAAA;AAAA;AAAA;AAAA;AAAA,8CAKbA,EAAQ;AAAA;AAAA;AAAA;AAAA;AAAA,0CAKZA,EAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAQlD,CAEA,SAAS1B,GAAwB,CAC/B,MAAO;AAAA;AAAA;AAAA;AAAA;AAAA,uBAKcf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAyBvB,CAEA,MAAM8B,EAAqB,SAAS,cAClC,6BACF,EAEAxB,EAAS,iBAAiB,SAAUqC,CAAU,EAE9C,eAAeA,EAAWC,EAAO,CAC/BA,EAAM,eAAc,EACpB,MAAMC,EAAY,SAAS,cAAc,gBAAgB,EACnDC,EAAQ,SAAS,cAAc,mBAAmB,EAAE,MAC1D9B,IACA,MAAM+B,EAAYrC,EAAoB,MAAM,EACtCsC,EAAYC,EAAkBH,EAAOC,CAAS,EAEpD,GAAI,CACF,MAAMG,EAAW,MAAMC,EAAWH,CAAS,EAE3CI,EAAY,EAAI,EAChB,SAAS,KAAK,MAAM,SAAW,SAC/B,aAAa,WAAW,MAAM,EAC9BpC,IACAP,GACD,MAAC,CACAoC,EAAU,MAAM,QAAU,QAC1B,WAAW,IAAMA,EAAU,MAAM,QAAU,OAAQ,GAAI,CACxD,CACH,CAEA,SAASI,EAAkBH,EAAOC,EAAW,CAC3C,MAAO,CACL,MAAOD,EACP,SAAUC,EAAU,IAAI5B,IAAS,CAC/B,UAAWA,EAAK,IAChB,OAAQA,EAAK,QACnB,EAAM,CACN,CACA,CAEA,SAASiC,EAAYC,EAAO,GAAM,CAChC9C,EAAY,UAAU,OAAO,mBAAoB,CAAC8C,CAAI,EAClDA,GACFC,IAEF,SAAS,KAAK,MAAM,SAAW,QACjC,CAEA,SAASA,GAAwB,CACT,SAAS,cAAc,yBAAyB,EACxD,iBAAiB,QAAS,IAAMF,EAAY,EAAK,CAAC,EAChE7C,EAAY,iBAAiB,QAASqC,GAAS,CACzCA,EAAM,SAAWrC,GACnB6C,EAAY,EAAK,CAEvB,CAAG,CAEH"}